<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Passerines Diversification • treesliceR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Passerines Diversification">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">treesliceR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Intro-treesliceR.html">Introduction to treesliceR</a></li>
    <li><a class="dropdown-item" href="../articles/Passeriformes-distribution.html">Passerines Distribution</a></li>
    <li><a class="dropdown-item" href="../articles/Passeriformes-diversification.html">Passerines Diversification</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/AraujoMat/treesliceR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Passerines Diversification</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AraujoMat/treesliceR/blob/master/vignettes/Passeriformes-diversification.Rmd" class="external-link"><code>vignettes/Passeriformes-diversification.Rmd</code></a></small>
      <div class="d-none name"><code>Passeriformes-diversification.Rmd</code></div>
    </div>

    
    
<p>This article aims to replicate the case study developed by <a href="https://github.com/AraujoMat/treesliceR" class="external-link">Araujo et al. (in
review)</a>. We will also present the workflow executed within the study
for both a single passerine phylogeny and multiple passerine
phylogenies, in order to control the results for phylogenetic
uncertainty <a href="https://doi.org/10.1111/evo.12644" class="external-link">Rangel et
al. (2015)</a>.</p>
<p>Before starting our analysis, we’ll need to load the
<code>ape</code>, <code>ggplot2</code>, <code>ggpubr</code>, and
<code>sf</code> packages. Additionally, if required, install the
<code>devtools</code> to invoke the <code>treesliceR</code> package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Loading the packages that we'll use</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/emmanuelparadis/ape" class="external-link">ape</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></code></pre></div>
<p>Now, we’ll need to load (and install if necessary) the
<code>treesliceR</code> package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Loading it</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/AraujoMat/treesliceR" class="external-link">treesliceR</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="passerines-study-for-a-single-phylogeny">1. Passerines study for a single phylogeny<a class="anchor" aria-label="anchor" href="#passerines-study-for-a-single-phylogeny"></a>
</h2>
<div class="section level3">
<h3 id="first-framework-example">1.1. First framework example<a class="anchor" aria-label="anchor" href="#first-framework-example"></a>
</h3>
<p>Herein, we’ll compare the distribution of passerine species richness
between ancient and recent lineages. Additionally, we’ll map the
distribution of their respective ancient and recent endemic species
(i.e., regions of paleo- and neo-endemism). The passerine phylogenies we
used are subsets of the global bird phylogenies provided by <a href="https://doi.org/10.1038/nature11631" class="external-link">Jetz et al. (2012)</a>.</p>
<p>First, we load the passerine phylogeny available within the package
by calling the <code>pass_trees</code> object:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="va">pass_trees</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>Now, we need to split the phylogeny into two distinct portions: one
representing ancient lineages and another representing those originating
from recent cladogenesis events. To do this, we categorically defined
ancient species as those with tips ages beyond the 75th percentile,
while more derived were categorized as those located within the 25th
percentile.</p>
<p>We can prune the tips outside the defined thresholds from our
phylogeny using the <code><a href="../reference/prune_tips.html">prune_tips()</a></code> function, setting the
argument <code>qtl = TRUE</code> to prune the tips based on quantile
values:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ancient</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prune_tips.html">prune_tips</a></span><span class="op">(</span><span class="va">tree</span>, <span class="fl">0.75</span>, qtl <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">recent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prune_tips.html">prune_tips</a></span><span class="op">(</span><span class="va">tree</span>, <span class="fl">0.25</span>, qtl <span class="op">=</span> <span class="cn">TRUE</span>, method <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>The <code>method = 2</code> setting makes the function prune the tips
older than the specified temporal threshold. For more details, see the
argument descriptions by tipping <code><a href="../reference/prune_tips.html">?prune_tips</a></code>.</p>
<p>Let’s compare our original phylogeny with the pruned ones:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="co"># Setting an 1x3 graphical display</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree</span>, main <span class="op">=</span> <span class="st">"Complete tree"</span>, show.tip.label <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/pkg/ape/man/axisPhylo.html" class="external-link">axisPhylo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ancient</span>, main <span class="op">=</span> <span class="st">"Ancient tree"</span>, show.tip.label <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/pkg/ape/man/axisPhylo.html" class="external-link">axisPhylo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">recent</span>, main <span class="op">=</span> <span class="st">"Recent tree"</span>, show.tip.label <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/pkg/ape/man/axisPhylo.html" class="external-link">axisPhylo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span> <span class="co"># Returning to the original display</span></span></code></pre></div>
<p><img src="Passeriformes-diversification_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Next, we need to obtain the species presence-absence matrix
separately for each phylogeny. Let’s start with the ancient
phylogeny:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anc_mat</span> <span class="op">&lt;-</span> <span class="va">pass_mat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pass_mat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ancient</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Now we’ll create another presence-absence matrix with the passerine
endemics, based on a quantile threshold of the 30th percentile of the
ancient species’ range size:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anc_end_mat</span> <span class="op">&lt;-</span> <span class="va">anc_mat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">anc_mat</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">anc_mat</span><span class="op">)</span>, <span class="fl">0.30</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>The same needs to be computed for recent species. We will subset
their presence-absence matrix for all recent species and another for
their endemics using the same criteria:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># All recent</span></span>
<span><span class="va">rec_mat</span> <span class="op">&lt;-</span> <span class="va">pass_mat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pass_mat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">recent</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># Endemics</span></span>
<span><span class="va">rec_end_mat</span> <span class="op">&lt;-</span> <span class="va">rec_mat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">rec_mat</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">rec_mat</span><span class="op">)</span>, <span class="fl">0.30</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Finally, we’ll add all the species richness information to the grid
assemblages (<code>AU_grid</code> object):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AU_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">AU_grid</span>, </span>
<span>                 SR_anc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">anc_mat</span><span class="op">)</span>, SR_end_anc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">anc_end_mat</span><span class="op">)</span>, <span class="co"># Ancient</span></span>
<span>                 SR_rec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">rec_mat</span><span class="op">)</span>, SR_end_rec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">rec_end_mat</span><span class="op">)</span><span class="op">)</span> <span class="co"># Recent</span></span></code></pre></div>
<p>Now, we can create a graph similar to the one displayed in Araujo et
al. (in review) using the <code>ggplot2</code> package. Let’s start with
the ancient species:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Before plotting, let's set a cool palette:</span></span>
<span><span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#30009B"</span>, <span class="st">"#000083"</span>, <span class="st">"#009BFE"</span>, <span class="st">"#00BC00"</span>, <span class="st">"#FEF600"</span>, <span class="st">"#FE6230"</span>, <span class="st">"#DD0000"</span> <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># All species</span></span>
<span><span class="va">fig_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">AU_grid</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">SR_anc</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">pal</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>                       limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">AU_grid</span><span class="op">$</span><span class="va">SR_anc</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       na.value<span class="op">=</span><span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">SR</span><span class="op">[</span><span class="st">"ancient"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.15</span>, <span class="fl">.14</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,</span>
<span>        legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>        legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Only endemics</span></span>
<span><span class="va">fig_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">AU_grid</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">SR_end_anc</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">pal</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>                       limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">AU_grid</span><span class="op">$</span><span class="va">SR_end_anc</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       na.value<span class="op">=</span><span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">SR</span><span class="op">[</span><span class="st">"ancient"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.15</span>, <span class="fl">.14</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,</span>
<span>        legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>        legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To plot them together</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">fig_a</span>, <span class="va">fig_b</span>,</span>
<span>          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a)"</span>, <span class="st">"b)"</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Passeriformes-diversification_files/figure-html/unnamed-chunk-11-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>and for those recent species:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># All species</span></span>
<span><span class="va">fig_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">AU_grid</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">SR_rec</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">pal</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>                       limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">AU_grid</span><span class="op">$</span><span class="va">SR_rec</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       na.value<span class="op">=</span><span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">SR</span><span class="op">[</span><span class="st">"recent"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.15</span>, <span class="fl">.14</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,</span>
<span>        legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>        legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Only endemics</span></span>
<span><span class="va">fig_d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">AU_grid</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">SR_end_rec</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">pal</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>                       limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">AU_grid</span><span class="op">$</span><span class="va">SR_end_rec</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       na.value<span class="op">=</span><span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">SR</span><span class="op">[</span><span class="st">"recent"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.15</span>, <span class="fl">.14</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,</span>
<span>        legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>        legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To plot them together</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">fig_c</span>, <span class="va">fig_d</span>,</span>
<span>          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"c)"</span>, <span class="st">"d)"</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Passeriformes-diversification_files/figure-html/unnamed-chunk-12-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>Note that the final output may differ slightly from what was observed
in Araujo et al. (in review). However, it’s important to remember that
here we conducted the analysis using only a single passerine phylogeny.
A more comprehensive assessment using all phylogenies could be conducted
in subsequent sections below (for example in the section “<em>2.
Passerines study for multiple phylogenies</em>”).</p>
</div>
<div class="section level3">
<h3 id="second-framework-example">1.2. Second framework example<a class="anchor" aria-label="anchor" href="#second-framework-example"></a>
</h3>
<p>Herein, we’ll calculate the CpB-rate of Australian passerines for
both <em>turnover</em> and <em>nestedness</em> components. Firstly,
we’ll need to load the assemblages containing the species matrix stored
within the package by calling the internal object <code>pass_mat</code>.
Additionally, to calculate the beta-diversity metrics, it is necessary
to provide the adjacency matrix containing the focal cells and their
respective neighborhoods, which can be accessed through the
<code>AU_adj</code> object. Let’s examine the header of the assemblage
matrix containing the species, focusing on the first four columns (or
species):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pass_mat</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Heteromyias_albispecularis Myzomela_obscura Taeniopygia_guttata</span></span>
<span><span class="co">#&gt; 1                          0                1                   0</span></span>
<span><span class="co">#&gt; 2                          0                1                   0</span></span>
<span><span class="co">#&gt; 3                          0                1                   0</span></span>
<span><span class="co">#&gt; 4                          0                1                   0</span></span>
<span><span class="co">#&gt; 5                          0                1                   0</span></span>
<span><span class="co">#&gt; 6                          0                1                   0</span></span>
<span><span class="co">#&gt;   Dicaeum_hirundinaceum</span></span>
<span><span class="co">#&gt; 1                     1</span></span>
<span><span class="co">#&gt; 2                     1</span></span>
<span><span class="co">#&gt; 3                     1</span></span>
<span><span class="co">#&gt; 4                     1</span></span>
<span><span class="co">#&gt; 5                     1</span></span>
<span><span class="co">#&gt; 6                     1</span></span></code></pre></div>
<p>We can run some sensitivity analysis to find the most parsimonious
number of slices to assess the CpB-rate patterns. But first, we need to
create a vector containing our desired number of slices for
assessment:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">250</span>, <span class="fl">500</span>, <span class="fl">750</span>, <span class="fl">1000</span>, <span class="fl">1250</span>, <span class="fl">1500</span>, <span class="fl">1750</span>, <span class="fl">2000</span><span class="op">)</span></span></code></pre></div>
<p>Let’s run the sensitivity analysis for both <em>turnover</em> and
<em>nestedness</em> components:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sens_turn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_sensitivity.html">CpR_sensitivity</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">tree</span>, vec <span class="op">=</span> <span class="va">vec</span>, samp <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                             mat <span class="op">=</span> <span class="va">pass_mat</span>, adj <span class="op">=</span> <span class="va">AU_adj</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, comp <span class="op">=</span> <span class="st">"turnover"</span><span class="op">)</span></span>
<span><span class="va">sens_nest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_sensitivity.html">CpR_sensitivity</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">tree</span>, vec <span class="op">=</span> <span class="va">vec</span>, samp <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                             mat <span class="op">=</span> <span class="va">pass_mat</span>, adj <span class="op">=</span> <span class="va">AU_adj</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, comp <span class="op">=</span> <span class="st">"nestedness"</span><span class="op">)</span></span></code></pre></div>
<p>So, we can visualize our sensitivity analysis using the
<code>CpR_sensitivity_plot</code> function. We use the
<code>ggplot2</code> syntax to add a vertical line showing our selected
number of slices to run our subsequent analysis:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Store each graph within a respective object</span></span>
<span><span class="va">turn_sens_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_sensitivity_plot.html">CpR_sensitivity_plot</a></span><span class="op">(</span><span class="va">sens_turn</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, stc <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">1000</span>, linetype<span class="op">=</span><span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span><span class="va">nest_sens_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_sensitivity_plot.html">CpR_sensitivity_plot</a></span><span class="op">(</span><span class="va">sens_nest</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, stc <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">1000</span>, linetype<span class="op">=</span><span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span><span class="co"># To plot them together</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">turn_sens_plot</span>, <span class="va">nest_sens_plot</span>,</span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a)"</span>, <span class="st">"b)"</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="OneTree_sensitivity.png" width="80%" style="display: block; margin: auto;"></p>
<p>Now, we can finally calculate the CpB-rates for <em>turnover</em> and
<em>nestedness</em> components, in this case, under a multisite approach
(<strong>PS:</strong> this may take a few minutes):</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For turnover component</span></span>
<span><span class="va">turn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpB.html">CpB</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">tree</span>, n <span class="op">=</span> <span class="fl">1000</span>, mat <span class="op">=</span> <span class="va">pass_mat</span>, adj <span class="op">=</span> <span class="va">AU_adj</span>, comp <span class="op">=</span> <span class="st">"turnover"</span><span class="op">)</span></span>
<span><span class="co"># For nestedness component</span></span>
<span><span class="va">nest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpB.html">CpB</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">tree</span>, n <span class="op">=</span> <span class="fl">1000</span>, mat <span class="op">=</span> <span class="va">pass_mat</span>, adj <span class="op">=</span> <span class="va">AU_adj</span>, comp <span class="op">=</span> <span class="st">"nestedness"</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can plot these CpB over time and map them. To map them,
we’ll use an Australian grid map stored within our package in the object
<code>AU_grid</code>. Let’s plot these patterns for the turnover
component:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turn_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_graph.html">CpR_graph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">turn</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, qtl <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">turn_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_graph.html">CpR_graph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">turn</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, qtl <span class="op">=</span> <span class="cn">TRUE</span>, map <span class="op">=</span> <span class="va">AU_grid</span><span class="op">)</span></span>
<span><span class="co"># To plot them together</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">turn_1</span>, <span class="va">turn_2</span>,</span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a)"</span>, <span class="st">"b)"</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="OneTree_turn.png" style="display: block; margin: auto;"></p>
<p>And we can do the same for the nestedness component:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nest1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_graph.html">CpR_graph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nest</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, qtl <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">nest2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_graph.html">CpR_graph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nest</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, qtl <span class="op">=</span> <span class="cn">TRUE</span>, map <span class="op">=</span> <span class="va">AU_grid</span><span class="op">)</span></span>
<span><span class="co"># To plot them together</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">nest1</span>, <span class="va">nest2</span>,</span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a)"</span>, <span class="st">"b)"</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="OneTree_nest.png" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="passerines-study-for-multiple-phylogenies">2. Passerines study for multiple phylogenies<a class="anchor" aria-label="anchor" href="#passerines-study-for-multiple-phylogenies"></a>
</h2>
<div class="section level3">
<h3 id="first-framework-example-1">2.1. First framework example<a class="anchor" aria-label="anchor" href="#first-framework-example-1"></a>
</h3>
<p>Herein, we’ll replicate the process from the previous section using
multiple (100) phylogenies. We’ll utilize all these phylogenies to
account for phylogenetic uncertainty associated with the inputted
tips.</p>
<p>Let’s start by creating empty <code>data.frames</code> to store the
species richness for each category (i.e., ancient vs. recent, all
species vs. endemics):</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Data frames for ancient lineages:</span></span>
<span><span class="va">mat_anc_rich</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">AU_grid</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mat_anc_endemics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">AU_grid</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Data frames for recent ones:</span></span>
<span><span class="va">mat_rec_rich</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">AU_grid</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mat_rec_endemics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">AU_grid</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then, we can automate the procedures executed in the first section
for all our 100 phylogenies by simply using a <code>for()</code> loop to
iterate over each phylogeny:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a for loop that iterate along all trees</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Select phylogeny "i" available within the package:</span></span>
<span>  <span class="va">tree</span> <span class="op">&lt;-</span> <span class="va">pass_trees</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="co"># Prune the "i" phylogeny based on quantiles:</span></span>
<span>  <span class="va">ancient</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prune_tips.html">prune_tips</a></span><span class="op">(</span><span class="va">tree</span>, <span class="fl">0.75</span>, qtl <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="va">recent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prune_tips.html">prune_tips</a></span><span class="op">(</span><span class="va">tree</span>, <span class="fl">0.25</span>, qtl <span class="op">=</span> <span class="cn">T</span>, method <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Capture the presence-absence matrix for ancient species:</span></span>
<span>  <span class="va">anc_mat</span> <span class="op">&lt;-</span> <span class="va">pass_mat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pass_mat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ancient</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">mat_anc_rich</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">anc_mat</span><span class="op">)</span> <span class="co"># Save their species richness</span></span>
<span>  <span class="co"># Capture ancient endemic richness in Australia:</span></span>
<span>  <span class="va">anc_mat</span> <span class="op">&lt;-</span> <span class="va">anc_mat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">anc_mat</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">anc_mat</span><span class="op">)</span>, <span class="fl">0.30</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">mat_anc_endemics</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">anc_mat</span><span class="op">)</span> <span class="co"># Save their species richness</span></span>
<span>  </span>
<span>  <span class="co"># Capturing the presence-absence matrix for recent species:</span></span>
<span>  <span class="va">rec_mat</span> <span class="op">&lt;-</span> <span class="va">pass_mat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pass_mat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">recent</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">mat_rec_rich</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">rec_mat</span><span class="op">)</span> <span class="co"># Save their species richness</span></span>
<span>  <span class="co"># Capturing recent endemic richness in Australia:</span></span>
<span>  <span class="va">rec_mat</span> <span class="op">&lt;-</span> <span class="va">rec_mat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">rec_mat</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">rec_mat</span><span class="op">)</span>, <span class="fl">0.30</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">mat_rec_endemics</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">rec_mat</span><span class="op">)</span> <span class="co"># Save their species richness</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Similarly as before, we can assign the mean species richness values
of each category to our <code>AU_grid</code> assemblages:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assigning ancient species richness</span></span>
<span><span class="va">AU_grid</span><span class="op">$</span><span class="va">SR_anc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">mat_anc_rich</span><span class="op">)</span></span>
<span><span class="va">AU_grid</span><span class="op">$</span><span class="va">SR_end_anc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">mat_anc_endemics</span><span class="op">)</span></span>
<span><span class="co"># Assigning recent species richness</span></span>
<span><span class="va">AU_grid</span><span class="op">$</span><span class="va">SR_rec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">mat_rec_rich</span><span class="op">)</span></span>
<span><span class="va">AU_grid</span><span class="op">$</span><span class="va">SR_end_rec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">mat_rec_endemics</span><span class="op">)</span></span></code></pre></div>
<p>Let’s plot it!</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># All ancient species</span></span>
<span><span class="va">fig_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">AU_grid</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">SR_anc</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">pal</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>                       limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">AU_grid</span><span class="op">$</span><span class="va">SR_anc</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       na.value<span class="op">=</span><span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">SR</span><span class="op">[</span><span class="st">"ancient"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.15</span>, <span class="fl">.14</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,</span>
<span>        legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>        legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Only ancient endemics</span></span>
<span><span class="va">fig_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">AU_grid</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">SR_end_anc</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">pal</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>                       limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">AU_grid</span><span class="op">$</span><span class="va">SR_end_anc</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       na.value<span class="op">=</span><span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">SR</span><span class="op">[</span><span class="st">"ancient"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.15</span>, <span class="fl">.14</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,</span>
<span>        legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>        legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># All recent species</span></span>
<span><span class="va">fig_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">AU_grid</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">SR_rec</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">pal</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>                       limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">AU_grid</span><span class="op">$</span><span class="va">SR_rec</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       na.value<span class="op">=</span><span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">SR</span><span class="op">[</span><span class="st">"recent"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.15</span>, <span class="fl">.14</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,</span>
<span>        legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>        legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Only recent endemics</span></span>
<span><span class="va">fig_d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">AU_grid</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">SR_end_rec</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">pal</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>                       limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">AU_grid</span><span class="op">$</span><span class="va">SR_end_rec</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       na.value<span class="op">=</span><span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">SR</span><span class="op">[</span><span class="st">"recent"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.15</span>, <span class="fl">.14</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,</span>
<span>        legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>        legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To plot them together</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">fig_a</span>, <span class="va">fig_b</span>, <span class="va">fig_c</span>, <span class="va">fig_d</span>,</span>
<span>          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a)"</span>, <span class="st">"b)"</span>, <span class="st">"c)"</span>, <span class="st">"d)"</span><span class="op">)</span>, </span>
<span>          ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Passeriformes-diversification_files/figure-html/unnamed-chunk-25-1.png" width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="second-framework-example-1">2.2. Second framework example<a class="anchor" aria-label="anchor" href="#second-framework-example-1"></a>
</h3>
<p>Once we have already decided on the number of slices in the previous
sections (in section “<strong>1.2.</strong>”), we’ll skip the
sensitivity analysis step to calculate the CpB-rates. Thus, here we’ll
calculate the CpB-rate for the 100 phylogenies using our previously
defined criterion of 1000 slices.</p>
<p>First, we’ll run the CpB-rate analysis for the
<strong>turnover</strong> component. To obtain our CpB-rates faster for
our 100 phylogenies, pay attention that we set the <code><a href="../reference/CpB.html">CpB()</a></code>
function to run under parallel programming (using the argument
<code>ncor</code>). Before run it, you <strong>must</strong> confirm if
the number of cores set (5) is supported by your machine. Anyway, the
following function can may take some minutes to finish, but it can run
faster if you are able to set a higher number of cores:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CpB_turn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">pass_trees</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/CpB.html">CpB</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">x</span>, n <span class="op">=</span> <span class="fl">1000</span>, mat <span class="op">=</span> <span class="va">pass_mat</span>, adj <span class="op">=</span> <span class="va">AU_adj</span>, comp <span class="op">=</span> <span class="st">"turnover"</span>, ncor <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Now, we capture can capture the mean of each parameter outputted in
on our list of <code><a href="../reference/CpB.html">CpB()</a></code> outputs using the
<code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply()</a></code> function. We’ll store them within a new data frame
containing the format that our <code><a href="../reference/CpR_graph.html">CpR_graph()</a></code> is able to read
(which is the same as the <code><a href="../reference/CpB.html">CpB()</a></code> output):</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CpB_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">CpB_turn</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">pB_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">CpB_turn</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">pBO_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">CpB_turn</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co"># Creating the new data frame</span></span>
<span><span class="va">turn_100trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>CpB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">CpB_val</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span>,</span>
<span>                            pB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">pB_val</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span>,</span>
<span>                            pBO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">pBO_val</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Plotting the CpB outputs for the turnover component:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turn_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_graph.html">CpR_graph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">turn_100trees</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, qtl <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">turn_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_graph.html">CpR_graph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">turn_100trees</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, qtl <span class="op">=</span> <span class="cn">TRUE</span>, map <span class="op">=</span> <span class="va">AU_grid</span><span class="op">)</span></span>
<span><span class="co"># To plot them together</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">turn_1</span>, <span class="va">turn_2</span>,</span>
<span>          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a)"</span>, <span class="st">"b)"</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="AllTrees_turn.png" style="display: block; margin: auto;"></p>
<p>Now, we’ll do the same for the <strong>nestedness</strong>
component:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CpB_nest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">pass_trees</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/CpB.html">CpB</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">x</span>, n <span class="op">=</span> <span class="fl">1000</span>, mat <span class="op">=</span> <span class="va">pass_mat</span>, adj <span class="op">=</span> <span class="va">AU_adj</span>, comp <span class="op">=</span> <span class="st">"nestedness"</span>, ncor <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Separating and summarizing each parameter:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CpB_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">CpB_nest</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">pB_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">CpB_nest</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">pBO_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">CpB_nest</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co"># DF</span></span>
<span><span class="va">nest_100trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>CpB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">CpB_val</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span>,</span>
<span>                            pB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">pB_val</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span>,</span>
<span>                            pBO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">pBO_val</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Plotting the CpB outputs for the nestedness component:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nest_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_graph.html">CpR_graph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nest_100trees</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, qtl <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">nest_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_graph.html">CpR_graph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nest_100trees</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, qtl <span class="op">=</span> <span class="cn">TRUE</span>, map <span class="op">=</span> <span class="va">AU_grid</span><span class="op">)</span></span>
<span><span class="co"># To plot them together</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">nest_1</span>, <span class="va">nest_2</span>,</span>
<span>          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a)"</span>, <span class="st">"b)"</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="AllTrees_nest.png" style="display: block; margin: auto;"></p>
<p>That’s all folks!</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Jetz, W., Thomas, G. H., Joy, J. B., Hartmann, K. and Mooers, A. O.
2012. The global diversity of birds in space and time. - Nature
491(7424): 444–448. <a href="https://doi.org/10.1038/nature11631" class="external-link uri">https://doi.org/10.1038/nature11631</a></p>
<p>Rangel, T. F., Colwell, R. K., Graves, G. R., Fučíková, K., Rahbek,
C. and Diniz-Filho, J. A. F. 2015. Phylogenetic uncertainty revisited:
Implications for ecological analyses. - Evolution 69(5): 1301–1312. <a href="https://doi.org/10.1111/evo.12644" class="external-link uri">https://doi.org/10.1111/evo.12644</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matheus Lima Araujo, Luiz Gabriel Souza e Souza Ferreira, Gabriel Nakamura, Marco Tulio Pacheco Coelho, Thiago Fernando Rangel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
