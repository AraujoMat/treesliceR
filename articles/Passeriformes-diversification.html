<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="treesliceR">
<title>Passerines Diversification • treesliceR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Passerines Diversification">
<meta property="og:description" content="treesliceR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">treesliceR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Intro_treeSlicer.html">Introduction to treesliceR</a>
    <a class="dropdown-item" href="../articles/Passeriformes-distribution.html">Passerines Distribution</a>
    <a class="dropdown-item" href="../articles/Passeriformes-diversification.html">Passerines Diversification</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/AraujoTheus/treesliceR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Passerines Diversification</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AraujoTheus/treesliceR/blob/HEAD/vignettes/Passeriformes-diversification.Rmd" class="external-link"><code>vignettes/Passeriformes-diversification.Rmd</code></a></small>
      <div class="d-none name"><code>Passeriformes-diversification.Rmd</code></div>
    </div>

    
    
<p>This article aims to replicate the case study developed by <a href="https://github.com/AraujoMat/treesliceR" class="external-link">Araujo et al. (in
review)</a>. We will also present the workflow executed within the study
for both a single passerine phylogeny and multiple passerine
phylogenies, in order to control the results for phylogenetic
uncertainty <a href="https://doi.org/10.1111/evo.12644" class="external-link">Rangel et
al. (2015)</a>.</p>
<p>Before starting our analysis, we’ll need to load the
<code>ape</code>, <code>ggplot2</code>, and <code>ggpubr</code>
packages. Additionally, if required, install the <code>devtools</code>
to invoke the <code>treesliceR</code> package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creating a list of our desired packages</span></span>
<span><span class="va">libs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ape"</span>, <span class="st">"devtools"</span>, <span class="st">"ggplot2"</span>, <span class="st">"ggpubr"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Checking if they're installed</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="va">libs</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">libs</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Loading them</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://ape-package.ird.fr/" class="external-link">ape</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span></span></code></pre></div>
<p>Now, we’ll need to load (and install if necessary) the
<code>treesliceR</code> package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Is it already present within the machine?</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"treesliceR"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"AraujoMat/treesliceR"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Loading it</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/AraujoTheus/treesliceR" class="external-link">treesliceR</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="passerines-study-for-a-single-phylogeny">1. Passerines study for a single phylogeny<a class="anchor" aria-label="anchor" href="#passerines-study-for-a-single-phylogeny"></a>
</h2>
<div class="section level3">
<h3 id="first-framework-example">1.1. First framework example<a class="anchor" aria-label="anchor" href="#first-framework-example"></a>
</h3>
<p>Herein, we’ll compare the passerines tip diversification rates (DR)
before and after the Australian aridification (~33 Mya). Our used
passerines phylogenies are subsets of the global birds phylogenies made
available by <a href="https://doi.org/10.1038/nature11631" class="external-link">Jetz et
al. (2012)</a>.</p>
<p>Thus, primarily, we can load the passerines phylogeny available
within the package by calling the <code>pass_trees</code> object:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="va">pass_trees</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>Now, we need to split the phylogeny into two distinct portions, one
representing the last 33 millions of years ago (Mya) and another
representing the cladogenesis events before this period. To capture the
root slice before 33 Mya, we can slice our phylogeny tipwardly (i.e.,
from tips to root) using the <code><a href="../reference/squeeze_tips.html">squeeze_tips()</a></code> function.
Alternatively, the phylogeny slice of the last 33 Mya can be obtained
through the <code><a href="../reference/squeeze_root.html">squeeze_root()</a></code> function, which slices a
phylogeny rootwardly (i.e, from root to tips).</p>
<p>Since DR calculations are dependent on the node’s path to a given
tip, we set the argument <code>dropNodes = TRUE</code> in our functions
to remove those “void nodes” (nodes with zero branch length) to avoid
biases in our DR estimates:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/squeeze_root.html">squeeze_root</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">tree</span>, time <span class="op">=</span> <span class="fl">33</span>, dropNodes <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">old</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/squeeze_tips.html">squeeze_tips</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">tree</span>, time <span class="op">=</span> <span class="fl">33</span>, dropNodes <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p>Let’s compare our original phylogeny with those cut ones:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="co"># Setting an 1x3 graphical display</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree</span>, main <span class="op">=</span> <span class="st">"Complete tree"</span>, show.tip.label <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/pkg/ape/man/axisPhylo.html" class="external-link">axisPhylo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">old</span>, main <span class="op">=</span> <span class="st">"Old tree"</span>, show.tip.label <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/pkg/ape/man/axisPhylo.html" class="external-link">axisPhylo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">recent</span>, main <span class="op">=</span> <span class="st">"Recent tree"</span>, show.tip.label <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/pkg/ape/man/axisPhylo.html" class="external-link">axisPhylo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># Returning to a simple 1x1 display</span></span></code></pre></div>
<p><img src="Sliced_pas_tree.png" style="display: block; margin: auto;"></p>
<p>Then, we need to calculate the DR separately for each phylogeny slice
while finding the difference between them. To calculate the DR, we can
use the <code><a href="../reference/DR.html">DR()</a></code> function available within the
<code>treesliceR</code> package:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DR_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DR.html">DR</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">recent</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="../reference/DR.html">DR</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">old</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<p>Now we’ll assign these DR differences to a data frame inside our tree
object containing passerines information:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree</span><span class="op">$</span><span class="va">Species_info</span><span class="op">$</span><span class="va">DR_diff</span> <span class="op">&lt;-</span> <span class="va">DR_diff</span></span></code></pre></div>
<p>To calculate the mean and standard deviation differences per family,
we use the <code><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply()</a></code> function to aggregate the calculated
DRs by passerine families:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tapply() for means</span></span>
<span><span class="va">fam_DR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">Species_info</span><span class="op">$</span><span class="va">DR_diff</span>, <span class="va">tree</span><span class="op">$</span><span class="va">Species_info</span><span class="op">$</span><span class="va">Family</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="co"># tapply() for standard deviations</span></span>
<span><span class="va">fam_DR_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">Species_info</span><span class="op">$</span><span class="va">DR_diff</span>, <span class="va">tree</span><span class="op">$</span><span class="va">Species_info</span><span class="op">$</span><span class="va">Family</span>, <span class="va">sd</span><span class="op">)</span></span></code></pre></div>
<p>To visualize DR differences among families, we’ll create a new data
frame with our outputs:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creating the families DR data frame</span></span>
<span><span class="va">fam_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fam_DR</span><span class="op">)</span>, DR_diff <span class="op">=</span> <span class="va">fam_DR</span>, DR_sd <span class="op">=</span> <span class="va">fam_DR_sd</span><span class="op">)</span></span>
<span><span class="co"># Sorting them based on DR's value</span></span>
<span><span class="va">fam_df</span> <span class="op">&lt;-</span> <span class="va">fam_df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">fam_df</span><span class="op">$</span><span class="va">DR_diff</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="co"># Turning this order into a factor to plot it</span></span>
<span><span class="va">fam_df</span><span class="op">$</span><span class="va">Family</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">fam_df</span><span class="op">$</span><span class="va">Family</span>, levels <span class="op">=</span> <span class="va">fam_df</span><span class="op">$</span><span class="va">Family</span><span class="op">)</span></span></code></pre></div>
<p>Now, we can create a graph similar to the one displayed in <a href="">Araujo et al. (in review)</a> using the <code>ggplot2</code>
package:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fam_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Family</span>, y <span class="op">=</span> <span class="va">DR_diff</span>,</span>
<span>                    ymin <span class="op">=</span> <span class="va">DR_diff</span> <span class="op">-</span> <span class="va">DR_sd</span>,</span>
<span>                    ymax <span class="op">=</span> <span class="va">DR_diff</span> <span class="op">+</span> <span class="va">DR_sd</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#d90429"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype<span class="op">=</span><span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>        axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>        panel.grid.major.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.minor.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">DR</span><span class="op">[</span><span class="st">"recent"</span><span class="op">]</span><span class="op">-</span><span class="va">DR</span><span class="op">[</span><span class="st">"past"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="OneTree_DR.png" width="60%" style="display: block; margin: auto;"></p>
<p>Notice that the final output is slightly different from what was
observed in <a href="">Araujo et al. (in review)</a>. However, remember
that here we executed the analysis only for a single passerine
phylogeny. A more comprehensive assessment using all phylogenies could
be carried out in the sections below (for example in the section “<em>2.
Passerines study for multiple phylogenies</em>”).</p>
</div>
<div class="section level3">
<h3 id="second-framework-example">1.2. Second framework example<a class="anchor" aria-label="anchor" href="#second-framework-example"></a>
</h3>
<p>Herein, we’ll calculate the CpB-rate of Australian passerines for
both <em>turnover</em> and <em>nestedness</em> components. Firstly,
we’ll need to load the assemblages paired with their respective
neighborhoods. These assemblages are stored within the package in an
intern object called <code>pass_asb</code>. This object is a list of
presence-absences matrices, where each list contains a given Australian
focal cell and its respective neighboring cells. So, let’s check the
header of the first matrix within the list, focusing on the first four
columns (or species):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pass_asb</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Myzomela_obscura Dicaeum_hirundinaceum Hirundo_nigricans Artamus_personatus</span></span>
<span><span class="co">#&gt; 6                 1                     1                 1                  1</span></span>
<span><span class="co">#&gt; 5                 1                     1                 1                  1</span></span>
<span><span class="co">#&gt; 7                 1                     1                 1                  1</span></span>
<span><span class="co">#&gt; 16                1                     1                 1                  1</span></span>
<span><span class="co">#&gt; 17                1                     1                 1                  1</span></span>
<span><span class="co">#&gt; 18                1                     1                 1                  1</span></span></code></pre></div>
<p>We can run some sensitivity analysis to find the most parsimonious
number of slices to assess the CpB-rate patterns. But first, we need to
create a vector containing our desired number of slices for
assessment:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">250</span>, <span class="fl">500</span>, <span class="fl">750</span>, <span class="fl">1000</span>, <span class="fl">1250</span>, <span class="fl">1500</span>, <span class="fl">1750</span>, <span class="fl">2000</span><span class="op">)</span></span></code></pre></div>
<p>Let’s run the sensitivity analysis for both <em>turnover</em> and
<em>nestedness</em> components:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sens_turn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_sensitivity.html">CpR_sensitivity</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">tree</span>, vec <span class="op">=</span> <span class="va">vec</span>, samp <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                             asb <span class="op">=</span> <span class="va">pass_asb</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, comp <span class="op">=</span> <span class="st">"turnover"</span><span class="op">)</span></span>
<span><span class="va">sens_nest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_sensitivity.html">CpR_sensitivity</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">tree</span>, vec <span class="op">=</span> <span class="va">vec</span>, samp <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                             asb <span class="op">=</span> <span class="va">pass_asb</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, comp <span class="op">=</span> <span class="st">"nestedness"</span><span class="op">)</span></span></code></pre></div>
<p>So, we can visualize our sensitivity analysis using the
<code>CpR_sensitivity_plot</code> function. We use the
<code>ggplot2</code> syntax to add a vertical line showing our selected
number of slices to run our subsequent analysis:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Store each graph within a respective object</span></span>
<span><span class="va">turn_sens_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_sensitivity_plot.html">CpR_sensitivity_plot</a></span><span class="op">(</span><span class="va">sens_turn</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, stc <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">1000</span>, linetype<span class="op">=</span><span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span><span class="va">nest_sens_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_sensitivity_plot.html">CpR_sensitivity_plot</a></span><span class="op">(</span><span class="va">sens_nest</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, stc <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">1000</span>, linetype<span class="op">=</span><span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span><span class="co"># To plot them together</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">turn_sens_plot</span>, <span class="va">nest_sens_plot</span>,</span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a)"</span>, <span class="st">"b)"</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="OneTree_sensitivity.png" width="80%" style="display: block; margin: auto;"></p>
<p>Now, we can finally calculate the CpB-rates for <em>turnover</em> and
<em>nestedness</em> components, in this case, under a multisite approach
(<strong>PS:</strong> this may take a few minutes):</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For turnover component</span></span>
<span><span class="va">turn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpB.html">CpB</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">tree</span>, n <span class="op">=</span> <span class="fl">1000</span>, asb <span class="op">=</span> <span class="va">pass_asb</span>, comp <span class="op">=</span> <span class="st">"turnover"</span><span class="op">)</span></span>
<span><span class="co"># For nestedness component</span></span>
<span><span class="va">nest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpB.html">CpB</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">tree</span>, n <span class="op">=</span> <span class="fl">1000</span>, asb <span class="op">=</span> <span class="va">pass_asb</span>, comp <span class="op">=</span> <span class="st">"nestedness"</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can plot these CpB over time and map them. To map them,
we’ll use an Australian grid map stored within our package in the object
<code>AU_grid</code>. Let’s plot these patterns for the turnover
component:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turn_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_graph.html">CpR_graph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">turn</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, qtl <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">turn_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_graph.html">CpR_graph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">turn</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, qtl <span class="op">=</span> <span class="cn">TRUE</span>, map <span class="op">=</span> <span class="va">AU_grid</span><span class="op">)</span></span>
<span><span class="co"># To plot them together</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">turn_1</span>, <span class="va">turn_2</span>,</span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a)"</span>, <span class="st">"b)"</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="OneTree_turn.png" style="display: block; margin: auto;"></p>
<p>And we can do the same for the nestedness component:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nest1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_graph.html">CpR_graph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nest</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, qtl <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">nest2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_graph.html">CpR_graph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nest</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, qtl <span class="op">=</span> <span class="cn">TRUE</span>, map <span class="op">=</span> <span class="va">AU_grid</span><span class="op">)</span></span>
<span><span class="co"># To plot them together</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">nest1</span>, <span class="va">nest2</span>,</span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a)"</span>, <span class="st">"b)"</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="OneTree_nest.png" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="passerines-study-for-multiple-phylogenies">2. Passerines study for multiple phylogenies<a class="anchor" aria-label="anchor" href="#passerines-study-for-multiple-phylogenies"></a>
</h2>
<div class="section level3">
<h3 id="first-framework-example-1">2.1. First framework example<a class="anchor" aria-label="anchor" href="#first-framework-example-1"></a>
</h3>
<p>Herein, we’ll do the same as we have done in the previous section but
using multiple (100) phylogenies. We’ll use all these phylogenies to
control for phylogenetic uncertainty present in the position of inputted
tips.</p>
<p>Thus, let’s firstly cut our 100 phylogenies to compare their tip-DR
before and after Australia aridification (~33Mya). This can be done
easily for our list of trees using the <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code>
function:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">tree</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/squeeze_root.html">squeeze_root</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">33</span>, dropNodes <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">tree</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/squeeze_tips.html">squeeze_tips</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">33</span>, dropNodes <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>In the same way, we can calculate their species DR separately using
the same function:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DR_rec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">recent</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="../reference/DR.html">DR</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">DR_old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">old</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="../reference/DR.html">DR</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Once the DRs are calculated, we can capture their mean values per
species. However, since species positions are generally different among
the phylogenies, we’ll need to merge the lists based on the species
column:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Recent</span></span>
<span><span class="va">f_DRrec</span> <span class="op">&lt;-</span> <span class="va">DR_rec</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">f_DRrec</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="co"># Old</span></span>
<span><span class="va">f_DRold</span> <span class="op">&lt;-</span> <span class="va">DR_old</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">f_DRold</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># Looping</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">DR_rec</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Recent</span></span>
<span>  <span class="va">f_DRrec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">f_DRrec</span>, <span class="va">DR_rec</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"Species"</span>, sort <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">f_DRrec</span><span class="op">)</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">i</span></span>
<span>  <span class="co"># Old</span></span>
<span>  <span class="va">f_DRold</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">f_DRold</span>, <span class="va">DR_old</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"Species"</span>, sort <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">f_DRold</span><span class="op">)</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">i</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now, we can calculate the mean and standard deviation of DRs per
passerine species for each phylogeny time slice. Then, calculate their
mean differences as done in the first workflow for one phylogeny:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Recent</span></span>
<span><span class="va">DR_rec_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">f_DRrec</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">DR_rec_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">f_DRrec</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">sd</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Old</span></span>
<span><span class="va">DR_old_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">f_DRold</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">DR_old_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">f_DRold</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">sd</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Capturing their mean difference</span></span>
<span><span class="va">DR_diff</span> <span class="op">&lt;-</span> <span class="va">DR_rec_mean</span> <span class="op">-</span> <span class="va">DR_old_mean</span></span></code></pre></div>
<p>Again, we can merge these DR differences into a data frame inside our
tree object containing passerine information, and then obtain this
information per passerine family using the <code><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply()</a></code>
function:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Specie <span class="op">=</span> <span class="va">f_DRrec</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, DR_diff <span class="op">=</span> <span class="va">DR_diff</span><span class="op">)</span></span>
<span><span class="co"># Capturing families information</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">tree</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Species_info</span>, by <span class="op">=</span> <span class="st">"Specie"</span>, sort <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Displaying it graphically for families</span></span>
<span><span class="va">fam_DR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">DR_diff</span>, <span class="va">df</span><span class="op">$</span><span class="va">Family</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">fam_DR_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">DR_diff</span>, <span class="va">df</span><span class="op">$</span><span class="va">Family</span>, <span class="va">sd</span><span class="op">)</span></span></code></pre></div>
<p>Before plotting, we’ll create a new data frame containing our DRs per
family and sort it based on the highest DR values:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fam_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fam_DR</span><span class="op">)</span>, DR_diff <span class="op">=</span> <span class="va">fam_DR</span>, DR_sd <span class="op">=</span> <span class="va">fam_DR_sd</span><span class="op">)</span></span>
<span><span class="co"># Ordering to plot</span></span>
<span><span class="va">fam_df</span> <span class="op">&lt;-</span> <span class="va">fam_df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">fam_df</span><span class="op">$</span><span class="va">DR_diff</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">fam_df</span><span class="op">$</span><span class="va">Family</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">fam_df</span><span class="op">$</span><span class="va">Family</span>, levels <span class="op">=</span> <span class="va">fam_df</span><span class="op">$</span><span class="va">Family</span><span class="op">)</span></span></code></pre></div>
<p>Plotting it!</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fam_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Family</span>, y <span class="op">=</span> <span class="va">DR_diff</span>,</span>
<span>                    ymin <span class="op">=</span> <span class="va">DR_diff</span> <span class="op">-</span> <span class="va">DR_sd</span>,</span>
<span>                    ymax <span class="op">=</span> <span class="va">DR_diff</span> <span class="op">+</span> <span class="va">DR_sd</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#d90429"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype<span class="op">=</span><span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>        axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>        panel.grid.major.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.minor.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">DR</span><span class="op">[</span><span class="st">"recent"</span><span class="op">]</span><span class="op">-</span><span class="va">DR</span><span class="op">[</span><span class="st">"past"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="AllTrees_DR.png" width="60%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="second-framework-example-1">2.2. Second framework example<a class="anchor" aria-label="anchor" href="#second-framework-example-1"></a>
</h3>
<p>Once we have already decided on the number of slices in the previous
sections (in section “<strong>1.2.</strong>”), we’ll skip the
sensitivity analysis step to calculate the CpB-rates. Thus, here we’ll
calculate the CpB-rate for the 100 phylogenies using our previously
defined criterion of 1000 slices.</p>
<p>First, we’ll run the CpB-rate analysis for the
<strong>turnover</strong> component. To obtain our CpB-rates faster for
our 100 phylogenies, pay attention that we set the <code><a href="../reference/CpB.html">CpB()</a></code>
function to run under parallel programming (using the argument
<code>ncor</code>). Before run it, you <strong>must</strong> confirm if
the number of cores set (5) is supported by your machine. Anyway, the
following function can may take some minutes to finish, but it can run
faster if you are able to set a higher number of cores:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CpB_turn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">pass_trees</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/CpB.html">CpB</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">x</span>, n <span class="op">=</span> <span class="fl">1000</span>, asb <span class="op">=</span> <span class="va">pass_asb</span>, comp <span class="op">=</span> <span class="st">"turnover"</span>, ncor <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Now, we capture can capture the mean of each parameter outputted in
on our list of <code><a href="../reference/CpB.html">CpB()</a></code> outputs using the
<code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply()</a></code> function. We’ll store them within a new data frame
containing the format that our <code><a href="../reference/CpR_graph.html">CpR_graph()</a></code> is able to read
(which is the same as the <code><a href="../reference/CpB.html">CpB()</a></code> output):</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CpB_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">CpB_turn</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">pB_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">CpB_turn</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">pBO_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">CpB_turn</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co"># Creating the new data frame</span></span>
<span><span class="va">turn_100trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>CpB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">CpB_val</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span>,</span>
<span>                            pB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">pB_val</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span>,</span>
<span>                            pBO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">pBO_val</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Plotting the CpB outputs for the turnover component:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turn_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_graph.html">CpR_graph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">turn_100trees</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, qtl <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">turn_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_graph.html">CpR_graph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">turn_100trees</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, qtl <span class="op">=</span> <span class="cn">TRUE</span>, map <span class="op">=</span> <span class="va">AU_grid</span><span class="op">)</span></span>
<span><span class="co"># To plot them together</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">turn_1</span>, <span class="va">turn_2</span>,</span>
<span>          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a)"</span>, <span class="st">"b)"</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="AllTrees_turn.png" style="display: block; margin: auto;"></p>
<p>Now, we’ll do the same for the <strong>nestedness</strong>
component:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CpB_nest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">pass_trees</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/CpB.html">CpB</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">x</span>, n <span class="op">=</span> <span class="fl">1000</span>, asb <span class="op">=</span> <span class="va">pass_asb</span>, comp <span class="op">=</span> <span class="st">"nestedness"</span>, ncor <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Separating and summarizing each parameter:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CpB_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">CpB_nest</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">pB_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">CpB_nest</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">pBO_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">CpB_nest</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co"># DF</span></span>
<span><span class="va">nest_100trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>CpB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">CpB_val</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span>,</span>
<span>                            pB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">pB_val</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span>,</span>
<span>                            pBO <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">pBO_val</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Plotting the CpB outputs for the nestedness component:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nest_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_graph.html">CpR_graph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nest_100trees</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, qtl <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">nest_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CpR_graph.html">CpR_graph</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nest_100trees</span>, rate <span class="op">=</span> <span class="st">"CpB"</span>, qtl <span class="op">=</span> <span class="cn">TRUE</span>, map <span class="op">=</span> <span class="va">AU_grid</span><span class="op">)</span></span>
<span><span class="co"># To plot them together</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">nest_1</span>, <span class="va">nest_2</span>,</span>
<span>          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a)"</span>, <span class="st">"b)"</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="AllTrees_nest.png" style="display: block; margin: auto;"></p>
<p>That’s all folks!</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Jetz, W., Thomas, G. H., Joy, J. B., Hartmann, K. and Mooers, A. O.
2012. The global diversity of birds in space and time. - Nature
491(7424): 444–448. <a href="https://doi.org/10.1038/nature11631" class="external-link uri">https://doi.org/10.1038/nature11631</a></p>
<p>Rangel, T. F., Colwell, R. K., Graves, G. R., Fučíková, K., Rahbek,
C. and Diniz-Filho, J. A. F. 2015. Phylogenetic uncertainty revisited:
Implications for ecological analyses. - Evolution 69(5): 1301–1312. <a href="https://doi.org/10.1111/evo.12644" class="external-link uri">https://doi.org/10.1111/evo.12644</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matheus Lima Araujo, Luiz Gabriel Souza e Souza Ferreira, Marco Tulio Pacheco Coelho, Gabriel Nakamura, Thiago Fernando Rangel.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
